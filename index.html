<!DOCTYPE html>
<html>
<head>
	<title>The California Drought</title>
	<meta charset="utf-8">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <meta name="description" content="">
	<script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.17/firebase.js'></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.8/d3.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.1.0/topojson.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/base-min.css">
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">

	<style>
		html, body {
			overflow: hidden;
		}
		body {
			background-color: #FFFAEF;
		}
		svg {
			
		}
		path {
			opacity: 0.75;
		}
		path#dm0 {
			fill: #FFFF00;
		}
		path#dm1 {
			fill: #FCD37F;
		}
		path#dm2 {
			fill: #FFAA00;
		}
		path#dm3 {
			fill: #E60000;
		}
		path#dm4 {
			fill: #730000;
		}

		circle.dot {
			stroke: black;
			stroke-width: 2;
			fill: white;
		}
		#tooltip {
			position: absolute;
			width: 200px;
			height: auto;
			padding: 7px;
			border: .5px solid white;
			border-spacing: 5px;
			font-size: .7em;
			font-weight: bold;
			-webkit-border-radius: 2px;
			-moz-border-radius: 2px;
			border-radius: 2px;
			pointer-events: none;
		}
		#tooltip::before {
			background: none;
		  border: 1px solid black;
		  content: "";
		  display: block;
		  position: absolute;
		  top: 2px;
		  left: 2px;
		  right: 2px;
		  bottom: 2px;
		  pointer-events: none;
		  opacity: .5;
		}
		#tooltip.hidden {
			display: none;
		}
		.legend {
			position: absolute;
			width: 147px;
			height: auto;
			border: .5px solid white;
			border-spacing: 5px;
			font-size: .7em;
			font-weight: bold;
			left: 10px;
			bottom: 15px;
		}
		.legend-header {
			font-size: .85em;
			font-weight: bold;
			text-align: center;
			padding: 3px 0 3px 0;
			position: absolute;
			width: 147px;
			height: auto;
			left: 10px;
			bottom: 150px;
		}
		table.legend td {
			padding: 0 3px 0 3px;
		}
		tr#top-row td, tr#bottom-row td {
			padding-bottom: 3px;
		}
		div.color-key {
			width: 25px;
			height: 25px;
		}
		div#dm0 {
			background-color: #FFFF00;
		}
		div#dm1 {
			background-color: #FCD37F;
		}
		div#dm2 {
			background-color: #FFAA00;
		}
		div#dm3 {
			background-color: #E60000;
		}
		div#dm4 {
			background-color: #730000;
		}
		.article-container {
			top: 35px;
			bottom: 15px;
			position: absolute;
			overflow: auto;
			margin-left: 65px;
			padding: 5px 20px 5px 0px;
			opacity: 0.85;
		}
		.article-container header {
			font-size: 2em;
			line-height: 1;
			padding: 5px;
			max-width: 510px;
		}
		.article-container article {
			margin-top: 10px;
			padding: 5px 20px 5px 20px;
			max-width: 30em;
			line-height: 1.5;
			white-space: pre-line;
		}
		footer {
			font-size: 1.5em;
		}
		.shadow-box {
			background-color: white;
			-webkit-box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); 
			-moz-box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); 
			box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); 
		}
	</style>
</head>
<body class="content">
	<div class="pure-menu pure-menu-horizontal" style="background-color:#f0daad;">
    <a href="#" class="pure-menu-heading">The California Drought</a>
	</div>
	<div class="pure-g">
		<div class="pure-u-1-2 svg-container">
			<div class="legend legend-header shadow-box">Drought Intensity</div>
			<table class="legend shadow-box">
				<tr id="top-row">
					<td><div class="color-key" id="dm0"></div></td>
					<td>Abnormally Dry</td>
				</tr>
				<tr>
					<td><div class="color-key" id="dm1"></div></td>
					<td>Moderate Drought</td>
				</tr>
				<tr>
					<td><div class="color-key" id="dm2"></div></td>
					<td>Severe Drought</td>
				</tr>
				<tr>
					<td><div class="color-key" id="dm3"></div></td>
					<td>Extreme Drought</td>
				</tr>
				<tr id="bottom-row">
					<td><div class="color-key" id="dm4"></div></td>
					<td>Exceptional Drought</td>
				</tr>
			</table>
		</div>

		<div class="pure-u-1-2 article-container">
			<section>
				<header class="shadow-box">California's drought getting even worse, experts say</header>
				<article class="shadow-box">
					California's drought conditions have worsened over the past week with the percentage of the state suffering from the highest category increasing, the National Weather Service said Thursday.

					"Exceptional" drought conditions have spread in Central California since a week ago, weather officials said. Areas in Northern California have also moved into this category since last week, according to the U.S. Drought Monitor.

					Almost 33% of the state faces exceptional conditions. About 25% of the state faced those conditions last week.

					Every part of California remains in what is considered severe drought.

					A year ago, no part of the state was in exceptional drought conditions, the weather service said.

					The drought has prompted water conservation efforts as well as rationing in some parts of the state. L.A. saw record dry conditions this winter, and snowfall in the Sierras has also been significantly down.

					But the political impact of the drought has been a subject of debate.

					A USC Dornsife/Los Angeles Times poll in June found most Californians surveyed say the statewide drought has had little or no impact on their daily lives, and a majority oppose the suspension of environmental protections or large-scale public spending to boost water supplies.

					Although 89% characterize the drought as a major problem or crisis, only 16% say it has personally affected them to a major degree.

					Despite widespread news coverage of the drought the state's major population centers have largely escaped severe mandatory rationing.

					Even agriculture, which as California's thirstiest sector is inevitably hit the hardest by drought, has partially compensated for reduced water delivery by pumping more groundwater.
				</article>

				<!-- <footer>By Vincent Aviani</footer> -->
			</section>
		</div>
	</div>

	<script>
    var placesCollection = new Firebase('https://glaring-fire-1184.firebaseio.com/places'),
    	length;
    
    placesCollection.on('value', function(snapshot){
    	length = snapshot.numChildren();
    });
    
					
		var svgWidth = function(){
			if (window.innerWidth < 615 * 2) {
				return 615 + "px";
			} else {
				return window.innerWidth / 2;
			}
		},
		  svgHeight = window.innerHeight; //700px

		var projection = d3.geo.albers()
			.translate([50, svgHeight/2 - 110])
			//.translate([svgWidth*2, svgHeight / 2 + 50])
			.scale([3900])
			.rotate([123,0]);
		    
		var svg = d3.select(".svg-container").append("svg")
	    .attr("width", svgWidth)
	    .attr("height", svgHeight);

		var path = d3.geo.path()
		  .projection(projection);

		var dotRadius = 5,
			tooltip = d3.select(".svg-container").append("div")
    		.attr("id", "tooltip")
    		.attr("class", "shadow-box")
    		.style("opacity", 0);

    queue()
      .defer(d3.json, "california-drought-topo.json")
      .defer(d3.json, "https://glaring-fire-1184.firebaseio.com/places.json")
      .await(drawMap);

    function drawMap(error, map, places){
      svg.selectAll("path")
        .data(topojson.feature(map, map.objects.drought).features).enter()
        
        .append("path")
        	.attr("d", path)
        	.attr("id", function(d){
        		return "dm" + d.id;
        });

      svg.selectAll(".dot")
      	.data(places).enter()

        .append("circle")
          .attr("r", dotRadius)
          .attr("transform", function(d){
            return "translate(" + projection([
              d.location.longitude,
              d.location.latitude
            ]) + ")"
          })
          .attr("class", "dot")
          .attr("cursor", "pointer")

        .on("mouseover", function(d){
  	      d3.select(this)
        		.transition().ease("bounce")
						.attr("r", dotRadius * 2);
					
					tooltip
						//.transition().duration(150)
						.style("opacity", 1)
						.text(d.title)
						.style("left", (d3.event.pageX + 20) + "px")
						.style("top", (d3.event.pageY - 25) + "px");
        })

        .on("mouseout", function(){
        	tooltip
        		.transition().duration(100)
        		.style("opacity", 0);

        	d3.select(this)
        		.transition().duration(150)
        		.attr("r", dotRadius);
        })
        .on("click", function(d){
        	d3.select('header').data(places)
        		.text(function(){
        			return d.title;
        		});
        	d3.select('article').data(places)
        		.text(function(){
        			return d.text;
        		});
        });
    }
	</script>
</body>
</html>