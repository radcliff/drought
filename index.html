<!DOCTYPE html>
<html>
<head>
	<title>The California Drought</title>
	<meta charset="utf-8">
	<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.8/d3.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.1.0/topojson.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
	<style>
		html, body {
			overflow: hidden;
		}
		svg {
			border: 1px solid black;
		}
		path {
			opacity: 0.7;
		}
		path#dm0 {
			fill: #FFFF00;
		}
		path#dm1 {
			fill: #FCD37F;
		}
		path#dm2 {
			fill: #FFAA00;
		}
		path#dm3 {
			fill: #E60000;
		}
		path#dm4 {
			fill: #730000;
		}

		circle.dot {
			stroke: black;
			stroke-width: 2;
			fill: none;
		}
	</style>
</head>
<body>
	<script>
		var places = [
		  {
		    name: "San Diego",
		    location: {
		      latitude: 32.715738,
		      longitude: -117.1610838
		    }
		  },
		  {
		    name: "San Francisco",
		    location: {
		      latitude: 37.7749295,
		      longitude: -122.4194155
		    }
		  },
		  {
		    name: "Black Butte",
		    location: {
		      latitude: 41.39166669999999,
		      longitude: -122.3611111
		    }
		  }
		]

		var svgWidth = window.innerWidth - (window.innerWidth / 3),
		    	svgHeight = window.innerHeight - 20;

		var projection = d3.geo.albers()
			.translate([50, svgHeight/2 - 95])
			//.translate([svgWidth*2, svgHeight / 2 + 50])
			.scale([4000])
			.rotate([123,0]);
		    
		var svg = d3.select("body").append("svg")
	    .attr("width", svgWidth)
	    .attr("height", svgHeight);

		var path = d3.geo.path()
		  .projection(projection);

    queue()
      .defer(d3.json, "california-drought-topo.json")
      .await(drawMap);

    function drawMap(error, map){
      svg.selectAll("path")
        .data(topojson.feature(map, map.objects.drought).features)
        .enter()
        .append("path")
        	.attr("d", path)
        	.attr("id", function(d){
        		return "dm" + d.id;
        });
      svg.selectAll(".dot")
      	.data(places)
        .enter()
        .append("circle")
          .attr("r", 3)
          .attr("transform", function(d){
            return "translate(" + projection([
              d.location.longitude,
              d.location.latitude
            ]) + ")"
          })
          .attr("class", "dot");
    }
	</script>
</body>
</html>
