<!DOCTYPE html>
<html>
<head>
	<title>The California Drought</title>
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.8/d3.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.1.0/topojson.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/base-min.css">
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">

	<style>
		html, body {
			overflow: hidden;
		}
		body {
			background-color: #FFFAEF;
		}
		svg {
			
		}
		path {
			opacity: 0.75;
		}
		path#dm0 {
			fill: #FFFF00;
		}
		path#dm1 {
			fill: #FCD37F;
		}
		path#dm2 {
			fill: #FFAA00;
		}
		path#dm3 {
			fill: #E60000;
		}
		path#dm4 {
			fill: #730000;
		}

		circle.dot {
			stroke: black;
			stroke-width: 2;
			fill: white;
		}
		#tooltip {
			position: absolute;
			width: 200px;
			height: auto;
			padding: 7px;
			border: .5px solid white;
			border-spacing: 5px;
			font-size: .7em;
			font-weight: bold;
			-webkit-border-radius: 2px;
			-moz-border-radius: 2px;
			border-radius: 2px;
			pointer-events: none;
		}
		#tooltip::before {
			background: none;
		  border: 1px solid black;
		  content: "";
		  display: block;
		  position: absolute;
		  top: 2px;
		  left: 2px;
		  right: 2px;
		  bottom: 2px;
		  pointer-events: none;
		  opacity: .5;
		}
		#tooltip.hidden {
			display: none;
		}
		.legend {
			position: absolute;
			width: 147px;
			height: auto;
			border: .5px solid white;
			border-spacing: 5px;
			font-size: .7em;
			font-weight: bold;
			left: 10px;
			bottom: 15px;
		}
		.legend-header {
			font-size: .85em;
			font-weight: bold;
			text-align: center;
			padding: 3px 0 3px 0;
			position: absolute;
			width: 147px;
			height: auto;
			left: 10px;
			bottom: 150px;
		}
		table.legend td {
			padding: 0 3px 0 3px;
		}
		tr#top-row td, tr#bottom-row td {
			padding-bottom: 3px;
		}
		div.color-key {
			width: 25px;
			height: 25px;
		}
		div#dm0 {
			background-color: #FFFF00;
		}
		div#dm1 {
			background-color: #FCD37F;
		}
		div#dm2 {
			background-color: #FFAA00;
		}
		div#dm3 {
			background-color: #E60000;
		}
		div#dm4 {
			background-color: #730000;
		}
		.article-container {
			max-width: 30em;
			top: 35px;
			bottom: 15px;
			position: absolute;
			overflow: auto;
			margin-left: 25px;
			padding: 10px;
		}
		header {
			font-size: 2em;
			line-height: 1;
			padding: 5px; 
		}
		article {
			margin-top: 10px;
			padding: 5px 20px 5px 20px;
			line-height: 1.5;
		}
		footer {
			font-size: 1.5em;
		}
		.shadow-box {
			background-color: white;
			-webkit-box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); 
			-moz-box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); 
			box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); 
		}
	</style>
</head>
<body class="content">
	<div class="pure-menu pure-menu-horizontal" style="background-color:#f0daad;">
    <a href="#" class="pure-menu-heading">The California Drought</a>
	</div>
	<div class="pure-g">
		<div class="pure-u-1-2 svg-container">
			<div class="legend legend-header shadow-box">Drought Intensity</div>
			<table class="legend shadow-box">
				<tr id="top-row">
					<td><div class="color-key" id="dm0"></div></td>
					<td>Abnormally Dry</td>
				</tr>
				<tr>
					<td><div class="color-key" id="dm1"></div></td>
					<td>Moderate Drought</td>
				</tr>
				<tr>
					<td><div class="color-key" id="dm2"></div></td>
					<td>Severe Drought</td>
				</tr>
				<tr>
					<td><div class="color-key" id="dm3"></div></td>
					<td>Extreme Drought</td>
				</tr>
				<tr id="bottom-row">
					<td><div class="color-key" id="dm4"></div></td>
					<td>Exceptional Drought</td>
				</tr>
			</table>
		</div>

		<div class="pure-u-1-2 article-container">
			<section>
				<header class="shadow-box">Drought in California May Make Water More Valuable Than Gold</header>
				<article class="shadow-box" style="opacity:0.85">
					With California experiencing the greatest drought in its recorded history, and voluntary conservation measures only marginally reducing overall water usage, the Golden State may see water rates soar to the level where water becomes more valuable than gold.

					With no rain or snow for most of California for the past three years, 2014 has turned out to be among the driest years in the state’s 164-year history. According to the U.S. Draught Monitor, one-third of California is in a state of “exceptional drought” — the most severe level of drought conditions. “Extreme drought” coverage, the second worst category, has now climbed to 67 percent. This is almost twice the level of extreme drought that was recorded in the drought of 2007.

					Recognizing the severity of this historic drought on the state, California Governor Jerry Brown declared a State of Emergency on January 17 and then again on April 25, the governor issued an executive order to speed up actions necessary to reduce harmful effects of the drought, and he called on all Californians to redouble their efforts to conserve water.

					“I’ve declared this emergency,” stated Governor Brown in an official Drought Declaration order issued from Sacramento.

					As a result, California communities from Alameda to Yucca Valley have implemented voluntary mandatory conservation efforts. However, these efforts are falling short of making a real impact on the overall drought challenges California faces. In fact, according to the Public Policy Institute of California, a California think tank, only 75 percent of California residents see the draught as a problem.

					“People don’t like being dictated to. They prefer voluntary to mandatory conservation,” said a spokesman for the Metropolitan Water District, which provides water to 19 million people in the Los Angeles and San Diego areas.

					Adding to this tepid response to water conservation is California’s complex water management system that lacks a cohesive water management strategy. For example, while only three companies provide the vast majority of Californians’ electricity, there are nearly 3,000 water providers statewide, all with different parameters. These water providers are as diverse as the communities they serve. This is why no California governor has ever been able to order mandatory water rationing statewide. Huge legal questions would arise about how mandatory rationing would work or whether any governor could even enforce the rules, particularly on farmers and their private wells. Therefore, in order to manage usage of water across California as well as prepare for continued drought conditions, many experts believe rates are going to increase dramatically, making water in California more valuable than gold.

					DroughtAccording to Circle of Blue, an independent research organization founded in 2000 by leading journalists and scientists, Fresno will see a more than 30 percent increase in its water fees during 2014 while Los Angeles will likely see a more than 19 percent increase in water rates during the year. San Diego residents have already seen their water rates rise on average 7.25 percent in 2014 with an additional 7.5 percent increase on the horizon in 2015. For San Diego residents, that means that some families could see their monthly water bills increase nearly $230 this year. Adding to these painful rate increases will be additional penalties that come in the form of stiff fines for excessive water usage. These penalties range from $374 to $1,000 for watering violations.

					The message is clear throughout California. Water is quickly as valuable as gold and becoming the most important commodity in the state, and without measurable rainfall in the future, the Golden State can expect to see water treated as liquid gold.
				</article>
				<!-- <footer>By Vincent Aviani</footer> -->
			</section>
		</div>
	</div>

	<script>
		var places = [
		  {
		    name: "San Diego",
		    title: "Drought in California May Make Water More Valuable Than Gold",
		    location: {
		      latitude: 32.715738,
		      longitude: -117.1610838
		    }
		  },
		  {
		    name: "San Francisco",
		    title: "San Francisco Hypocrites: 'Green' City Fails to Conserve Water During Drought",
		    location: {
		      latitude: 37.7749295,
		      longitude: -122.4194155
		    }
		  },
		  {
		    name: "Black Butte",
		    title: "California salmon migrate by truck as state helps fish through drought",
		    location: {
		      latitude: 41.39166669999999,
		      longitude: -122.3611111
		    }
		  }
		]

		var svgWidth = function(){
			if (window.innerWidth < 615 * 2) {
				return 615 + "px";
			} else {
				return window.innerWidth / 2;
			}
		},
		  svgHeight = window.innerHeight; //700px

		var projection = d3.geo.albers()
			.translate([50, svgHeight/2 - 110])
			//.translate([svgWidth*2, svgHeight / 2 + 50])
			.scale([3900])
			.rotate([123,0]);
		    
		var svg = d3.select(".svg-container").append("svg")
	    .attr("width", svgWidth)
	    .attr("height", svgHeight);

		var path = d3.geo.path()
		  .projection(projection);

		var dotRadius = 5,
			tooltip = d3.select(".svg-container").append("div")
    		.attr("id", "tooltip")
    		.attr("class", "shadow-box")
    		.style("opacity", 0);

    queue()
      .defer(d3.json, "california-drought-topo.json")
      .await(drawMap);

    function drawMap(error, map){
      svg.selectAll("path")
        .data(topojson.feature(map, map.objects.drought).features).enter()
        
        .append("path")
        	.attr("d", path)
        	.attr("id", function(d){
        		return "dm" + d.id;
        });

      svg.selectAll(".dot")
      	.data(places).enter()

        .append("circle")
          .attr("r", dotRadius)
          .attr("transform", function(d){
            return "translate(" + projection([
              d.location.longitude,
              d.location.latitude
            ]) + ")"
          })
          .attr("class", "dot")
          .attr("cursor", "pointer")

        .on("mouseover", function(d){
  	      d3.select(this)
        		.transition().ease("bounce")
						.attr("r", dotRadius * 2);
					
					tooltip
						//.transition().duration(150)
						.style("opacity", 1)
						.text(d.title)
						.style("left", (d3.event.pageX + 20) + "px")
						.style("top", (d3.event.pageY - 25) + "px");
        })

        .on("mouseout", function(){
        	tooltip
        		.transition().duration(100)
        		.style("opacity", 0);

        	d3.select(this)
        		.transition().duration(150)
        		.attr("r", dotRadius);
        })
        .on("click", function(){
        	console.log(this)
        });
    }
	</script>
</body>
</html>
